<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BFS Visualization with D3.js</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; }
    h2 { color: #333; margin-top: 20px; }
    svg { border: 1px solid #ccc; margin-top: 20px; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .node { fill: lightblue; stroke: steelblue; stroke-width: 2px; transition: fill 0.5s; }
    .visited { fill: orange; }
    .current { fill: red; }
    .queue { fill: yellow; }
    .link { stroke: #999; stroke-width: 2px; }
    text { font-size: 14px; font-weight: bold; pointer-events: none; }
    #runBtn { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; background: steelblue; color: white; border: none; border-radius: 5px; }
    #runBtn:hover { background: #1f4f99; }
  </style>
</head>
<body>
  <h2>BFS Visualization</h2>
  <button id="runBtn">Run BFS</button>
  <svg width="600" height="400"></svg>

  <script>
    const svg = d3.select("svg");
    const width = +svg.attr("width");
    const height = +svg.attr("height");

    // Example graph coordinates
    const graph = {
      nodes: [
        {id: 0, x: 100, y: 100},
        {id: 1, x: 400, y: 100},
        {id: 2, x: 100, y: 300},
        {id: 3, x: 400, y: 300}
      ],
      links: [
        {source: 0, target: 1},
        {source: 0, target: 2},
        {source: 1, target: 3},
        {source: 2, target: 0},
        {source: 3, target: 1}
      ]
    };

    // Draw links
    const link = svg.selectAll(".link")
      .data(graph.links)
      .join("line")
      .attr("class", "link")
      .attr("x1", d => graph.nodes[d.source].x)
      .attr("y1", d => graph.nodes[d.source].y)
      .attr("x2", d => graph.nodes[d.target].x)
      .attr("y2", d => graph.nodes[d.target].y);

    // Draw nodes
    const node = svg.selectAll(".node")
      .data(graph.nodes)
      .join("circle")
      .attr("class", "node")
      .attr("r", 30)
      .attr("cx", d => d.x)
      .attr("cy", d => d.y);

    // Draw labels
    const labels = svg.selectAll(".label")
      .data(graph.nodes)
      .join("text")
      .attr("x", d => d.x)
      .attr("y", d => d.y + 5)
      .attr("text-anchor", "middle")
      .text(d => d.id);

    async function runBFS() {
      const response = await fetch("http://127.0.0.1:8000/python/bfs", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          graph: {
            "0": [1, 2],
            "1": [0, 3],
            "2": [0],
            "3": [1]
          },
          start: 0
        })
      });
      const bfsData = await response.json();
      animateBFS(bfsData.steps);
    }

    function animateBFS(steps) {
      let stepIndex = 0;

      function updateStep() {
        const step = steps[stepIndex];

        node.attr("class", d => {
          if (d.id === step.current) return "node current";
          if (step.queue.includes(d.id)) return "node queue";
          if (step.visited.includes(d.id)) return "node visited";
          return "node";
        });

        stepIndex++;
        if (stepIndex < steps.length) {
          setTimeout(updateStep, 1000);
        }
      }

      updateStep();
    }

    document.getElementById("runBtn").addEventListener("click", runBFS);
  </script>
</body>
</html>
