<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BFS Visualizer</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f0f4f8;
    }
    svg {
      border: 1px solid #ccc;
      margin-top: 20px;
    }
    .node circle {
      fill: #61dafb;
      stroke: #333;
      stroke-width: 1.5px;
    }
    .node.visited circle {
      fill: #ffa500;
    }
    .node.current circle {
      fill: #ff4136;
    }
    .link {
      stroke: #999;
      stroke-width: 2px;
      marker-end: url(#arrow);
    }
    #controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    textarea {
      width: 400px;
      height: 100px;
    }
  </style>
</head>
<body>
  <h1>BFS Visualizer</h1>
  <div>
    <textarea id="graphInput">
{
  "A": ["B", "C"],
  "B": ["D", "E"],
  "C": ["F"],
  "D": [],
  "E": [],
  "F": []
}
    </textarea>
    <input type="text" id="startNode" placeholder="Start Node" value="A"/>
    <button onclick="startBFS()">Start BFS</button>
  </div>

  <div id="controls">
    <button onclick="prevStep()">Previous</button>
    <button onclick="nextStep()">Next</button>
    <span>Step: <span id="stepNumber">0</span></span>
  </div>

  <svg width="800" height="600"></svg>

<script>
const svg = d3.select("svg");
const width = +svg.attr("width");
const height = +svg.attr("height");

let graph = {};
let startNode = "A";
let steps = [];
let currentStep = 0;
let nodes = [];
let links = [];

function bfsSteps(graph, start) {
  const visited = new Set();
  const queue = [start];
  const order = [];
  const bfsStepsArr = [];

  while(queue.length > 0) {
    const node = queue.shift();
    if (!visited.has(node)) {
      visited.add(node);
      order.push(node);

      bfsStepsArr.push({
        current: node,
        queue: [...queue],
        visited: Array.from(visited),
        order_so_far: [...order]
      });

      for (const neighbor of graph[node] || []) {
        if (!visited.has(neighbor) && !queue.includes(neighbor)) {
          queue.push(neighbor);
        }
      }
    }
  }
  return bfsStepsArr;
}

function prepareGraphData(graph) {
  nodes = Object.keys(graph).map(d => ({ id: d }));
  links = [];
  for (const source in graph) {
    graph[source].forEach(target => links.push({ source, target }));
  }
}

function renderGraph() {
  svg.selectAll("*").remove();

  svg.append("defs").append("marker")
      .attr("id","arrow")
      .attr("viewBox","0 -5 10 10")
      .attr("refX",25)
      .attr("refY",0)
      .attr("markerWidth",6)
      .attr("markerHeight",6)
      .attr("orient","auto")
    .append("path")
      .attr("d","M0,-5L10,0L0,5")
      .attr("fill","#999");

  const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(100))
      .force("charge", d3.forceManyBody().strength(-500))
      .force("center", d3.forceCenter(width/2, height/2));

  const link = svg.append("g")
      .attr("class", "links")
      .selectAll("line")
      .data(links)
      .enter().append("line")
      .attr("class", "link");

  const node = svg.append("g")
      .attr("class", "nodes")
      .selectAll("g")
      .data(nodes)
      .enter().append("g")
      .attr("class","node");

  node.append("circle")
      .attr("r", 20);

  node.append("text")
      .attr("text-anchor","middle")
      .attr("dy",5)
      .text(d => d.id);

  simulation.on("tick", () => {
    link
      .attr("x1", d => d.source.x)
      .attr("y1", d => d.source.y)
      .attr("x2", d => d.target.x)
      .attr("y2", d => d.target.y);

    node.attr("transform", d => `translate(${d.x},${d.y})`);
  });

  updateStep(); // show initial step
}

function updateStep() {
  if (steps.length === 0) return;
  document.getElementById("stepNumber").textContent = currentStep + 1;

  const step = steps[currentStep];

  svg.selectAll(".node")
      .classed("visited", d => step.visited.includes(d.id))
      .classed("current", d => step.current === d.id);
}

function startBFS() {
  graph = JSON.parse(document.getElementById("graphInput").value);
  startNode = document.getElementById("startNode").value;
  steps = bfsSteps(graph, startNode);
  currentStep = 0;
  prepareGraphData(graph);
  renderGraph();
}

function nextStep() {
  if(currentStep < steps.length -1) currentStep++;
  updateStep();
}

function prevStep() {
  if(currentStep > 0) currentStep--;
  updateStep();
}

</script>
</body>
</html>
